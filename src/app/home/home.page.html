<ion-header translucent="true">
  <ion-toolbar>
    <ion-title>Academia de Lengua</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="page">
  <div class="container">

    <!-- METRICS TOP -->
    <div class="metrics">
      <ion-card class="metric">
        <ion-card-content>
          <div class="metric-title">Progreso general</div>
          <div class="metric-value">{{ overallPercent }}%</div>
        </ion-card-content>
      </ion-card>

      <ion-card class="metric">
        <ion-card-content>
          <div class="metric-title">M√≥dulos completados</div>
          <div class="metric-value">{{ completedModules }} / {{ totalModules }}</div>
        </ion-card-content>
      </ion-card>

      <ion-card class="metric">
        <ion-card-content>
          <div class="metric-title">Estado</div>
          <div class="metric-value">{{ statusText }}</div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- MAIN DASHBOARD GRID -->
    <div class="dash-grid">

      <!-- LEFT: Progress + modules -->
      <ion-card class="big-card">
        <ion-card-content>
          <div class="big-title">
            <span class="icon">üìä</span>
            <span>Tu progreso</span>
          </div>

          <!-- donut -->
          <div class="donut-wrap">
            <div
              class="donut"
              [ngStyle]="{ 'background': 'conic-gradient(#4f46e5 ' + donutDeg + 'deg, #e5e7eb 0deg)' }"
            >
              <div class="donut-center">
                <div class="donut-text">{{ overallPercent }}%</div>
              </div>
            </div>
          </div>

          <!-- search -->
          <ion-searchbar
            class="search"
            placeholder="Buscar m√≥dulo..."
            (ionInput)="onSearch($event)"
          ></ion-searchbar>

          <!-- module cards -->
          <div class="modules-grid">
            <button
              *ngFor="let m of filteredModules"
              class="module-btn"
              [ngClass]="m.colorClass"
              (click)="go(m.route)"
            >
              <div class="module-top">
                <div class="module-title">{{ m.title }}</div>
                <div class="module-emoji">{{ m.emoji }}</div>
              </div>
              <div class="module-sub">{{ m.subtitle }}</div>

              <div class="module-foot">
                <div class="mini-progress">
                  <div class="mini-bar" [style.width.%]="getModulePercent(m.key)"></div>
                </div>
                <div class="mini-text">{{ getModulePercent(m.key) }}%</div>
              </div>
            </button>
          </div>

          <!-- optional -->
          <!-- <ion-button fill="clear" size="small" (click)="resetProgress()">Reiniciar progreso</ion-button> -->
        </ion-card-content>
      </ion-card>

      <!-- RIGHT: Quick access -->
      <ion-card class="side-card">
        <ion-card-content>
          <div class="side-title">
            <span class="icon">üöÄ</span>
            <span>Acceso r√°pido</span>
          </div>

          <p class="side-text">Practica y eval√∫ate cuando quieras.</p>

          <ion-button expand="block" class="cta" (click)="go('/lecciones')">
            üß† Lecciones y Examen Final
          </ion-button>

          <div class="hint">
            Consejo: Si apruebas el examen final, tu progreso de ‚ÄúLecciones‚Äù se marca.
          </div>
        </ion-card-content>
      </ion-card>

    </div>
  </div>
</ion-content>
